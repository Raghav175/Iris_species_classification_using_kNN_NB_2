<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Iris ML Classifier</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
    background:linear-gradient(135deg,#eef2ff,#f8fafc);
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
}

.container-box{
    max-width:900px;
    margin:50px auto;
}

.card{
    border:none;
    border-radius:18px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
}

.predict-badge{
    font-size:22px;
    padding:12px 22px;
    border-radius:30px;
    background:#0d6efd;
    color:white;
    display:inline-block;
    margin-top:10px;
}

.table td, .table th{
    text-align:center;
    vertical-align:middle;
}

/* base cell style */
.cm td{
    font-weight:bold;
    color:white;
    background:#e9ecef;
    transition: background 0.3s ease;
}
</style>

</head>
<body>

<div class="container-box">

<!-- FORM -->
<div class="card p-4 mb-4">
    <h2 class="text-center mb-4">Iris Flower Classification Lab</h2>

    <form action="/predict" method="POST" class="row g-3">

        <div class="col-md-6">
            <label class="form-label">Sepal Length</label>
            <input type="number" step="any" class="form-control" name="sepal_length" required>
        </div>

        <div class="col-md-6">
            <label class="form-label">Sepal Width</label>
            <input type="number" step="any" class="form-control" name="sepal_width" required>
        </div>

        <div class="col-md-6">
            <label class="form-label">Petal Length</label>
            <input type="number" step="any" class="form-control" name="petal_length" required>
        </div>

        <div class="col-md-6">
            <label class="form-label">Petal Width</label>
            <input type="number" step="any" class="form-control" name="petal_width" required>
        </div>

        <div class="col-12">
            <label class="form-label">Model</label>
            <select name="model" class="form-select" required>
                <option value="knn">kNN (Distance Based)</option>
                <option value="nb">Naive Bayes (Probabilistic)</option>
            </select>
        </div>

        <div class="col-12">
            <button class="btn btn-primary w-100 btn-lg">Predict Species</button>
        </div>
    </form>
</div>


<!-- PREDICTION -->
{% if prediction %}
<div class="card p-4 mb-4 text-center">
    <h4>Prediction Result</h4>
    <div class="predict-badge">{{ prediction }}</div>
    <p class="mt-2 text-muted">Model Used: <b>{{ model_used }}</b></p>
</div>
{% endif %}


<!-- CONFUSION MATRIX -->
{% if confusion_matrix %}
<div class="card p-4 mb-4">
    <h4 class="text-center mb-3">Confusion Matrix</h4>

    <table class="table table-bordered cm">
        {% for row in confusion_matrix %}
        <tr>
            {% for val in row %}
            <td>{{ val }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
</div>
{% endif %}


<!-- CLASSIFICATION REPORT -->
{% if report_rows %}
<div class="card p-4 mb-4">
    <h4 class="text-center mb-3">Classification Report</h4>

    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Class</th>
                <th>Precision</th>
                <th>Recall</th>
                <th>F1 Score</th>
                <th>Support</th>
            </tr>
        </thead>

        <tbody>
        {% for row in report_rows %}
        <tr>
            <td><b>{{ row.label }}</b></td>
            <td>{{ row.precision }}</td>
            <td>{{ row.recall }}</td>
            <td>{{ row.f1 }}</td>
            <td>{{ row.support }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <h5 class="text-center mt-3">Accuracy: {{ accuracy }}</h5>
</div>
{% endif %}

</div>

<!-- HEATMAP COLOR SCRIPT -->
<script>
document.querySelectorAll(".cm td").forEach(td=>{
    let v = parseInt(td.innerText);

    if(isNaN(v)) return;

    // normalize assuming iris test size ~40
    let intensity = Math.min(v/40,1);

    let r = 50;
    let g = Math.floor(210 - intensity*140);
    let b = Math.floor(210 - intensity*180);

    td.style.backgroundColor = `rgb(${r},${g},${b})`;
});
</script>

</body>
</html>
